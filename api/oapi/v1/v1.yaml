openapi: 3.0.3
info:
  title: push-platform HTTP API
  description: push platform
  contact:
    email: dydwls121200@gmail.com
  version: 0.0.1
externalDocs:
  description: push platform github
  url: https://github.com/pickstudio/push-platform
servers:
  - url: http://localhost:50100/api/v1
    description: local server

tags:
  - name: push
    description: 푸쉬

paths:
  /_enqueue_from_dead_queue:
    post:
      summary: DLQ로 빠진 실패한 에러메세지들을 다시 queue에다가 집어 넣을 수 있도록 합니다.
      description: DLQ로 빠진 실패한 에러메세지들을 다시 queue에다가 집어 넣을 수 있도록 합니다.
      tags:
        - push
      responses:
        '200':
          description: 현재의 상황을 디스플레잉 해줄 수 있도록 합니다
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/status'
  /_status:
    post:
      tags:
        - push
      summary: send push message immediately
      description: send push message immediately
      responses:
        '200':
          description: 성공적으로 데이터를 가져옵니다
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/status'
  /_push:
    post:
      tags:
        - push
      summary: send push message immediately
      description: send push message immediately
      requestBody:
        description:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                messages:
                  type: array
                  items:
                    $ref: '#/components/schemas/message'
      responses:
        '200':
          description: 성공적으로 데이터를 가져옵니다
          content:
            application/json:
              schema:
                properties:
                  _status:
                    $ref: '#/components/schemas/status'
                  failed_messages:
                    type: array
                    items:
                      $ref: '#/components/schemas/failed_message'

components:
  schemas:
    failed_message:
      type: object
      description: a message
      required:
        - message
        - error
      properties:
        message:
          $ref: '#/components/schemas/message'

        error:
          description: an error each message
          type: string
          example: "an error each message"

    message:
      type: object
      description: a message
      required:
        - id
        - from
        - service
        - user_id
        - device
        - push_token
        - view_type
        - view
      properties:
        id:
          description: message identifier
          type: string
          example: "1234-wads-234f-adfq-1234"

        user_id:
          description: message owner
          type: string
          example: "1234-wads-234f-adfq-1234"

        from:
          description: for tracking who is send
          type: string
          

        service:
          description: one of service from pickstudio
          type: string
          enum:
            - BUDDYSTOCK
            - PICKME
            - DIJKSTRA

        device:
          description: device type to receive push message
          type: string
          example: IOS
          enum:
            - IOS
            - ANDROID
            - DESKTOP_CHROME

        push_token:
          description: actual push token by service
          type: string

        view_type:
          description: view type of push message
          type: string
          example: PLAIN
          enum:
            - PLAIN

        view:
          description: view object is actual push message format
          type: object
          oneOf:
            - $ref: '#/components/schemas/plain_view'

    plain_view:
      description: plain type push message
      type: object
      required:
        - title
        - content
        - thumbnail_url
        - scheme_url
        - alarm
        - created_at
      properties:
        title:
          type: string
        content:
          type: string
        thumbnail_url:
          type: string
        scheme_url:
          type: string
        alarm:
          type: string
        created_at:
          type: string

    status:
      type: object
      required:
        - time
        - queue_size
        - queue_admin_url
        - dead_queue_size
        - dead_queue_admin_url
        - manual
      properties:
        time:
          type: string
          example: '2022-04-12T07:03:15Z'
        queue_size:
          type: number
          
          example: 10
        queue_admin_url:
          type: string
          example: 'https://naver.com'
        dead_queue_size:
          type: number
          example: 10
        dead_queue_admin_url:
          type: string
          example: 'https://naver.com'
        manual:
          type: string
          example: '이거 어떻게 쓰는지 알고싶다면?'
